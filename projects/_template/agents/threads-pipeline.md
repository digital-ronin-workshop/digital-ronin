# Threads Pipeline — Архитектура агентов

> **Цель:** Генерация качественных тредов с проверкой на соответствие аудитории

---

## Схема пайплайна

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   IDEATOR    │ ──→ │   WRITER     │ ──→ │   EDITOR     │ ──→ │  AUDIENCE    │
│  (темы)      │     │  (тексты)    │     │  (стиль)     │     │  SIMULATOR   │
└──────────────┘     └──────────────┘     └──────────────┘     └──────┬───────┘
                                                                      │
                                                                      ↓
                                                               ┌────────────┐
                                                               │  Score ≥70%│
                                                               └──────┬─────┘
                                                                 YES  │  NO
                                                                 ↓    ↓
                                                            [PUBLISH] [REWRITE]
                                                                        │
                                                                        └──→ WRITER
```

---

## Агент 1: IDEATOR

### Задача
Генерирует темы для тредов на основе:
- `brand/audience.md` (боли аудитории)
- `content/threads-playbook.md` (форматы)

### Вход
- Количество тредов
- Микс форматов

### Выход
```json
{
  "themes": [
    {"id": 1, "topic": "[Тема]", "format": "[Формат]", "pain_point": "[Боль]"},
    ...
  ]
}
```

### Правила
- Не повторять темы из предыдущих генераций
- Соблюдать микс форматов
- Приоритет: критические боли → высокие → средние

---

## Агент 2: WRITER

### Задача
Пишет тексты тредов по темам от IDEATOR

### Контекст
- `content/threads-playbook.md` (шаблоны)
- `brand/voice-style.md` (голос)

### Правила
- Следовать шаблонам форматов
- Соблюдать голос эксперта
- CTA в конце

---

## Агент 3: EDITOR

### Задача
Проверяет тексты на соответствие voice-style

### Проверки
1. **Запрещённая лексика**
2. **Категоричные формулировки**
3. **Тон** — соответствует формуле голоса
4. **Обращения** — правильные
5. **Длина** — 100-300 слов для Threads

### Статусы
- `approved` → передать в AUDIENCE SIMULATOR
- `needs_fix` → отправить обратно в WRITER

---

## Агент 4: AUDIENCE SIMULATOR

### Задача
Имитирует реакцию аватаров на каждый тред

### Критерии оценки

| Критерий | Вес | Описание |
|----------|-----|----------|
| Узнаваемость | 30% | «Это про меня» |
| Эмоциональный отклик | 25% | Вызывает чувства |
| Полезность | 25% | Даёт понимание/инсайт |
| Желание поделиться | 20% | «Перешлю подруге» |

### Формат оценки

```json
{
  "avatar": "[Имя]",
  "score": 85,
  "reaction": "positive",
  "would_engage": true,
  "comment": "Узнала себя в описании",
  "criticism": "Хотелось бы больше конкретики"
}
```

### Финальный скор

```
Thread Score = (Аватар1 + Аватар2 + ...) / N

≥70% → PUBLISH
<70% → REWRITE (с фидбеком от аватаров)
```

---

## Цикл переписывания (REWRITE)

Если score < 70%:

1. Собрать фидбек от аватаров с низким скором
2. Передать в WRITER с инструкцией:
   - Какие боли не задеты
   - Что не сработало
3. WRITER переписывает
4. EDITOR проверяет
5. AUDIENCE SIMULATOR оценивает повторно
6. **Максимум 2 итерации**, потом → отклонить

---

## Learning Loop

```
PUBLISH → 48h → COLLECT metrics → ANALYZE → IMPROVE playbook
```

### Что обновлять после анализа

| Что узнали | Куда обновить |
|------------|---------------|
| Успешный формат | `content/threads-playbook.md` |
| Провальный формат | `learning/anti-patterns.md` |
| Инсайт об аудитории | `brand/audience.md` |
| Исправление голоса | `brand/voice-style.md` |

---

## Команды запуска

```
threads 5      # Сгенерировать 5 постов
threads 20     # Batch на неделю
```

---

*Pipeline Template v1.0 — Content Factory*
